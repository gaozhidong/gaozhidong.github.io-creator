---
title: "前端知识2020"
subtitle: ""
date: 2020-09-25T16:32:31+08:00
draft: true
author: "gaozhidong"

description: "这是描述"

tags: ["JavaScript", "HTML"]
categories: ["HTML"]

featuredImage: ""
featuredImagePreview: ""
---

<!--more-->
 
转载：

## 一、前端架构起源

### 为什么会出现前端架构？
十年前，当前端开发这个工种还很小众的时候，它的定位就是应用层的展示部分。用html、js、css完成几个功能简单的页面。因此，在很小规模的项目中，前端技术要素之间不会产生直接影响，因此无需架构相关的思考。当前端项目达到一定规模后，由于前端语言灵活松散的特性，工程化问题就会暴露出来成为发展瓶颈。之前相对孤立的技术要素彼此之间产生了影响和关联。

要用模块化开发，就必须对应某个模块化框架；用这个框架须对应某个构建工具；要用这个工具就必须使用某个包管理工具…这时候，就需要有人从比较高的角度去梳理、寻找适合自己团队的集成解决方案。这一系列解决问题的工具和手段就是前端架构。

每个前端团队都在打造自己的前端开发体系，通常是一个东拼西凑、逐渐磨合的过程。世上本没有路，走的人多了，便形成了路。在前端开发技术如火如荼的今日，这些过程已经被无数先驱团队踩过，并形成一个个开源解决方案。

## 二、前端架构的组成
如果一位面试官问你，你们的业务用什么架构？
有人回答是：React、Vue或者Angular
也可能是：jQuery或者underscore
再或者什么都不需要：原生 js 顺手动撸一套
或许得分最高的人是拿出了自己珍藏多年的前端技术栈脑图，从头至尾讲一遍：

fe-mobile > 前端架构2020 
![file](/images/2020-1.jpg)

但这些都不是架构，仅仅是架构的组成部分。

### 1、组件框架
 架构不等同于框架，更不是类库。
 框架是架构的重要组成部分，架构决定框架的选型，框架决定架构的技术路线。架构围绕着框架进行一系列的流程工具建设，从而形成完善自动的开发体系。
 组件框架又由以下元素组成：

* 开发模式：我们如何实现代码的职责分离，以前整个前端是MVC中V这一层，现在前端内部也进行MVC的逻辑细分，现在最流行的MVVM，如Vue.js。
* 通讯：模块化、组件化是前端推进开发模式过程中的一个过程产物，为了有效的进行组件隔离和独立。比较成熟的比如：消息总线、事件模拟、缓存中转、Flux 模型等等，其中在开源社区最有名的数EventEmitter3。
* 模板：前端重交互，有Vue 的template，React JSX，还有六七年前流行的 artTemplate等等。
* 基础类库：常用函数、方法、异步化，有 underscore、lodash等等，核心是为了改善编码生产力。
* 微前端：如何确保我的遗产代码能平滑的迁移，以及如何确保我在若干年后还能用上时下热门的技术栈？

目前，主流的组件框架有 React、Vue和小程序。很多上层生态都是基于这三个组件框架或者服务于它们的。很多人喜欢React是因为它是最早的组件化框架，面向对象编程，使用JSX描述模板，有Facebook背书。有人因为担心其开源协议的变化转而选择 Vue，Vue的中文社区非常完善。至于如何抉择就仁者见仁了。小程序的定位是使用微信、QQ、支付宝等平台的客户端能力提升Web体验，但因其缺乏统一标准就需要开发者维护多套代码库来兼容了。当然也出现了如：Taro等代码公用方案。

### 2、工具平台

工具平台是围绕我们研发流程的每一步关键节点建设起来的，是前端工程化的主要生产力。从项目仓库的初始化一直到项目发布上线、运营监控的整个过程都需要一系列的系统来承载和保障。

我们可以从代码管理、研发效率、框架支持、运营支持、运维监控五大方面进行描述，对于当前我们还没有的或者可以介入完善的我会使用红色标注：

#### 2.1 代码管理

* 代码管理工具Git：不熟悉的同学可以使用可视化工具 SourceTree ，当然对于研发还是使用IDE集成的工具更方便
* 代码规范工具ESLint：推荐研发同学直接安装IDE插件解决编码时规范约束、自动校正。
* 模块化工具：推荐使用webpack、rollup，老牌的 Seajs 和 requireJS 几乎被完全弃用。
* 组件库版本管理：推荐使用 Lerna，用于管理包含多个软件包（package）的 JavaScript 项目

#### 2.2 研发效率

* 脚手架：这个目前我们还没有，我们可以搭建一套属于自己的脚手架。目标是解决项目初始化、代码目录规范、代码编译、开发调试和打包编译等环节。推荐：vue-cli、create-react-app、以及支持服务端渲染的 Next.js。公司内，我们可以建立一套自己的脚手架流程，目标在制定统一的前端脚手架标准和接入方案，制定基于CLI/GUI的前端工程化工作流程，打造本地开发过程中的项目创建、本地开发、规范检查、快速发布的工作流。
* 联调体验：旨在解决项目从本地开发到线上维护过程中，环境搭建、接口Mock、抓包联调、产品体验、测试验证、线上抓包等问题，减少大家在非业务逻辑的重复性工作、提升研发效率。这个根据我的观察，目前我们做的已经不错了，一个完善的联调体验应当包含以下一些子工具辅助：
* nohost（whistle）：特点：浏览器插件、跨平台，可替代Fiddler/Charles。基于 whistle 实现的多用户多环境配置及抓包调试系统，不仅具备 whistle 的所有功能，并在 whistle 基础上扩展了一些功能，且支持多人多环境同时使用，支持mock插件。
* nginx基础设施：以提升问题定位效率为初衷，提供染色抓包、全息日志和异常发现的Node.js基础设施。
* mock接口管理平台、数据源管理、个人数据存储等。结合whistle插件提供交互界面实现自动拦截请求替换 mock 数据

* 持续集成：自动化构建-测试-发布工作流，持续、快速、高质量地交付你的产品。屏蔽掉所有研发流程中的繁琐环节，让你聚焦于编码。提供流水线、代码库、凭证管理、环境管理、研发商店等核心服务，多重组合，满足企业不同场景的需求。
* 重构效率：
Sketch 插件：打通协同设计能力，支持多种产出物的设计、分享、储存、调用。
视觉编译：可直接将Sketch设计稿通过机器学习转化为代码。
Web自动化测试：包括小程序性能、性能数据上报、测试用例、puppeteerUI自动化脚本等
国际化：统一公司内 i18n 标准化接入流程
#### 2.3 框架支撑
* 开发调试：Chrome模拟器、开发者工具Network、Performance TimeLine，whistle抓包请求、数据mock、本地代理、请求/响应模拟等
* IDE：推荐使用 VSCode，插件系统非常丰富
* 组件库：
前端通用组件库：建立在集团品牌之上的一套设计体系。旨在提升团队的合作效率，确保设计和开发效果的一致性，并且保证良好的用户体验。包含PC端、H5，具有Vue和React两套组件支持。
* 通用组件语言规范CLS：将组件抽象为统一模型，采用跨端的数据交换格式(如JSON)对组件进行标准化描述，与平台、语言、框架无关的组件规范。除以数据形式描述页面由组件构成外，也可用于后台驱动前端界面变化。
* 前端统一接入层：深度对接公司业务的Node层，适用于服务端渲染，提供业务转发，支持L5/Host 自动降级，接入机都收归到NGW配置统一管理，支持Serverless。基于 Docker和CI，降低开发&运维成本，提高研发效率。
#### 2.4 运维监控
前端监控：包含

* Aegis：一站式前端监控解决方案，涵盖了日志上报，错误监控，性能监控，资源测速等功能。支持白名单日志和离线日志！
* Sentry：知名的开源错误监控与管理系统，通过二次开发和内部部署在公司内网搭建了一套独立的sentry公用组件。支持微信/邮件告警。使得开发者能第一时间监控错误信息，更好定位和解决线上错误。完备的错误聚类分析与工作流管理，让每一个错误都无所遁形!
* AlloyData：通用型移动端性能优化分析平台，并希望能够提供极致图表分析能力以满足各种场景的性能分析与对比。
* weblog：用于前端在客户端上记录日志及实时捞取日志，分析日志，加速问题定位。
* shadow-log：提供一套用户行为帧录制与还原方案，通过对用户行为的录制，收集用户行为信息和界面变化信息，还原用户操作的每一帧界面，为 web产品的运行异常调试，以及对用户行为的研究，提供更直观的方案。
* emonitor前端监控SDK：支持多端（web、手Q、微信、iOS/Android webview、微信小程序），接入多套数据平台支撑

#### 2.5 运营支撑
* PV/UV：PCG有Monitor，微信增值有德鲁伊。都支持分钟级实时统计
* Bi：数据可视化工具
* 罗盘：支持数据统计、报表配置、多维度数据检索、邮件推送、对比查询和数据分析

### 3、代码结构 & 开发规范
代码结构跟业务、技术选型的特征和发展都有着密切关系，千人千面。

* 组件库应该放在哪？组件如何划分？公共组件如何抽离？如何管理版本？
* 基础库又应该放在哪？职责如何划分？如何更好地利用 TreeShaking？
* 多页应用和单页应用在业务膨胀时如何去组织管理？又应该如何打包发布？
这些都是我们应该慎重思考的问题。在实操时，应该及早的review项目，避免在历史包袱越来越重时候再去追悔莫及。
这里可以考虑通过完善脚手架CI的方式创建页面、组件、基础库和引用资源，约束业务代码结构规范，避免野蛮生长。

这里引用kp老师抛出的一些问题，给到大家反思自己的代码结构是否足够合理

* 假设当前的团队放大10倍，业务复杂10倍，当前的代码管理还能跟的上吗？
* 如何避免开发人员之间的开发行为耦合？
* 如何支撑多特性、多版本的并行？
* 主路径按功能、按版本还是按渠道？
推荐阅读：[前端开发体系建设日记](https://github.com/fouber/blog/issues/2)，虽然是14年的文章，但有很好的借鉴意思。

 不以规矩不成方圆。
 规范可帮我们极大的提升开发效率，真正优秀的规范不会让使用者感到约束，而是能帮他们快速定位问题，提升效率。
 需要关注的是，近几年 TypeScript 的发展越发蓬勃，其优秀的类型强约束和静态编译检查对于大型Web应用的开发具有很强的约束效果。我们所熟知的：VSCode和腾讯文档都是采用 TypeScript 编写的。

注：规范文档和规范约束工具同样重要

### 4、流程边界
* 随着移动应用的兴起，很多前端团队开始承担客户端的开发，如：Hybrid开发（微信JSSDK）、跨端框架（Hippy、QQAPI）、客户端预渲染、游戏开发（Cocos、Laya）等；
* 随着Node的兴起，也有很多前端团队承接后端轻逻辑的开发，如：服务端直出（NGW）、Serverless云函数（云开发framework、SCT、anode）；
* NW.js、和Electron更是让我们使用JavaScript构建跨平台桌面应用程序的能力，如：VSCode、微信小程序开发工具。其中VSCode更是成为大型Web应用的架构设计标杆，具有非凡的学习参考意义。
这些很多都来自前端团队自发的优化，这种优化需要团队的架构师敢于打破原有的边界，跟大团队一起重新定义新的工作边界，从而形成前端架构领域的放大和寻找更多技术创新的机会。

在研发流程上，我们也可以持续改进。如：

* 运营平台，让运营同学直接拿设计稿按照自己的需求去上传、配置、验证、发布。可达到每周发布活动上百个。前端团队的架构模型也得到了新的补充。
* 管理后台也是资源消耗大头，权限管理、配置管理让开发同学成长受限、持续苦恼。通过这些平台的标准化运营操作接口格式和规范以及统一的操作流程让后台开发也可以快速搭建想要的管理界面，不要跟前端沟通和联调。架构优化的价值再次体现。

### 5、核心理念
* 不同团队的架构模型必然不同，最好的架构一定是最适合团队和业务的架构。
* 一个架构还需要一个统一的牵引力去影响架构自身的成长迭代，这个牵引力是团队理念。统一的团队理念可以帮助我们在架构演进的过程中形成统一的技术选型、解题思路、价值观念。减少在这个过程中的无谓争执，甚至最后出现“都试一下”这种费时费力不负责任的结论。

### 6、经验沉淀
* 架构最强大的点在于控制，不怕你写不好代码，它能把风险控制在局部，能够让架构上的功能颗粒自动排列
* 架构最大的风险在于传承，诞生自少数人手中，但要依赖数代同事进行维护和进化
* 经验沉淀、理念传承

## 三、前端领域的技术趋势
正如前面流程边界所讲，很多前端成功技术和成果都来自于对原有流程边界的改造。好的架构师不会在既定的框架下苦苦挖掘，在泥坑里打滚。换块空地换个视角，或许可以做的更多。

### 1、中台建设
早在18年以前，阿里就开始逐步打造了一整套的中台体系，结合阿里云对外提供服务。具有代表性的前端开源组件库有：

* Ant Design：一度是国内最流行的中台组件库。以及配套的
* AntV：蚂蚁数据可视化包含：G2、F2(支持H5、小程序、Weex、Native)、G6（引擎与图分析工具）、X6、L7等等
但整个中台建设并不仅仅是个组件库就能搞定的，它包含：SOA、微服务、共享服务、中台运营能力、稳定性保障以及服务治理等等。前端作为其中一个重要环节起着可视化、低门槛、提效能等作用。

目前各团队（目测）都在使用不同的自研组件/第三方组件、平台、可视化开发、Severless、云开发、监控体系等等，内部闭环，各自重复造轮子，尚未形成完整体系的共享服务，这个也是可以挖掘的。

### 2、跨端动态化方案
近几年来谷歌开源的Flutter框架炒的热火朝天，得益于在iOS和Android双平台使用同一套代码，社区对其评价褒贬不一。
也有很多团队一直在钻研ReactNative，以及基于Vue的Weex。之前在腾讯，也有Hippy团队在持续探索这个生态。

### 3、特效和游戏
随着移动端设备性能的提升，平台赋予开发者的表现能力越来越强。从2D到3D，越来越多的游戏引擎，如：Cocos、Laya、白鹭、WebGL，以及WebSAssembly 都赋予我们生产酷炫能力的方法。虽然目前很少有互联网产品考虑用游戏引擎去做，但它绝对是一个令所有人期待和兴奋的点。这里需要关注3个点：

* Cocos 已经是目前小游戏平台最受欢迎的引擎，占比约70%以上
* WebSAssembly技术能让Web运行C/C++语言让Unity有了更大的舞台
* Phaser作为国外开源社区做火爆的引擎其源码架构具有非常好的学习借鉴价值（phaser3）
## 四、继续努力
前端是一个高速发展的赛道。由于缺乏标准，前端工程师成了最高产（造轮子）的码农，与此同时也不乏出现很多令人惊艳的技术以及各个团队积累多年的宝贵经验和工具。这些东西都让我们针对前端架构由不同的思考和理解。更有甚者，新的Web标准可能会完全打破现在的技术架构和认知，形成一套新的体系（如 Flutter）。


以上内容可能还有未想到的，欢迎大家一起来补充完善，希望做2021大家可以做一个更好的前端coder。

 